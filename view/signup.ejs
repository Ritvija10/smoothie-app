<%- include('partials/header'); -%>

<form class="signup" action="/controllers/signup_post" method="POST">
    <h2>Sign Up</h2>
    <label for="email">Email</label>
    <input type="text" name="email" required>
    <div class="email error"></div>
    <label for="password">Password</label>
    <input type="password" name="password" required>
    <div class="password error"></div>
    <div class="btnCenter">
    <button type="submit"><a href='/smoothies'>Signup</a></button>
    </div>
    <p>or</p>
    <p>Already a user?</p><a href="/login" class="loginBtn">Login</a>

</form>

<script>
    
  const form = document.querySelector('form.signup');
  const emailError = document.querySelector('.email.error');
  const passwordError = document.querySelector('.password.error');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    emailError.textContent = '';
    passwordError.textContent = '';

    const email = form.email.value;
    const password = form.password.value;

    try {
      const res = await fetch('/signup', {
        method: 'POST',
        body: JSON.stringify({ email, password }),
        headers: { 'Content-Type': 'application/json' }
      });

      const data = await res.json();

      // ❌ failed signup
      if (!res.ok) {
        emailError.textContent = data.errors?.email || '';
        passwordError.textContent = data.errors?.password || '';
        return;
      }

      // ✅ SUCCESS → redirect like before
      location.assign('/smoothies');

    } catch (err) {
      console.log(err);
    }
  });


    // // const crypto=require('crypto');
    // const form=document.querySelector('form');
    // const emailError=document.querySelector('.email.error');
    // const passwordError=document.querySelector('.password.error');

    // form.addEventListener('submit',async(e)=>{
    //     e.preventDefault();

    //     //reset errors
    //     emailError.textContent=' ';
    //     passwordError.textContent=' ';

    //     //get values
    //     const email=form.email.value;
    //     const password=form.password.value;

    //     try{
    //         const res=await fetch('/signup',{
    //             method:'POST',
    //             body:JSON.stringify({email,password}),
    //             headers:{'Content-Type':'application/json'}
    //         });
    //         const data=await res.json();
    //         console.log(data);
    //         if(data.errors){
    //             emailError.textContent=data.errors.email;
    //             passwordError.textContent=data.errors.password;

    //         }
    //         if(data.users){
    //             location.assign('/smoothies');
    //         }
            
    //     }
    //     catch(err){
    //         console.log(err);
    //     }
        
    // })
</script>
<%- include('partials/footer'); -%>
